! NOTE: Assertions have been autogenerated by /home/rpenacob/llvm-mono/mlir/utils/generate-test-checks.py
! RUN: flang-new -fc1 -fompss-2 -emit-llvm  -mmlir --mlir-print-ir-after-all %s -o /dev/null |& tail -n +$(flang-new -fc1 -fompss-2 -emit-llvm  -mmlir --mlir-print-ir-after-all %s -o /dev/null |& grep -n FIRToLLVMLowering | cut -f1 -d:) | FileCheck %s --check-prefix=LLVMIRDialect

PROGRAM P
    IMPLICIT NONE
    INTEGER ::X

    !$OSS TASK
    X = 888
    !$OSS END TASK

    IF (X /= 1) STOP 1

!    X = 999

    !$OSS TASK
    X = 777
    !$OSS END TASK

END PROGRAM P

! LLVMIRDialect-LABEL:   llvm.func @_QQmain() attributes {fir.bindc_name = "p"} {
! LLVMIRDialect:           %[[VAL_0:[-0-9A-Za-z._]+]] = llvm.mlir.constant(false) : i1
! LLVMIRDialect:           %[[VAL_1:[-0-9A-Za-z._]+]] = llvm.mlir.constant(1 : i32) : i32
! LLVMIRDialect:           %[[VAL_2:[-0-9A-Za-z._]+]] = llvm.mlir.constant(1 : i64) : i64
! LLVMIRDialect:           %[[VAL_3:[-0-9A-Za-z._]+]] = llvm.alloca %[[VAL_2]] x i32 {bindc_name = "x"} : (i64) -> !llvm.ptr
! LLVMIRDialect:           %[[VAL_4:[-0-9A-Za-z._]+]] = llvm.mlir.undef : i32
! LLVMIRDialect:           oss.task firstprivate(%[[VAL_3]], %[[VAL_3]] : !llvm.ptr, !llvm.ptr) firstprivate_type(%[[VAL_4]], %[[VAL_4]] : i32, i32) {
! LLVMIRDialect:             %[[VAL_5:[-0-9A-Za-z._]+]] = llvm.mlir.constant(888 : i32) : i32
! LLVMIRDialect:             llvm.store %[[VAL_5]], %[[VAL_3]] : i32, !llvm.ptr
! LLVMIRDialect:             oss.terminator
! LLVMIRDialect:           }
! LLVMIRDialect:           %[[VAL_6:[-0-9A-Za-z._]+]] = llvm.load %[[VAL_3]] : !llvm.ptr -> i32
! LLVMIRDialect:           %[[VAL_7:[-0-9A-Za-z._]+]] = llvm.icmp "ne" %[[VAL_6]], %[[VAL_1]] : i32
! LLVMIRDialect:           llvm.cond_br %[[VAL_7]], ^bb1, ^bb2
! LLVMIRDialect:         ^bb1:
! LLVMIRDialect:           %[[VAL_8:[-0-9A-Za-z._]+]] = llvm.call @_FortranAStopStatement(%[[VAL_1]], %[[VAL_0]], %[[VAL_0]])
! LLVMIRDialect:           llvm.unreachable
! LLVMIRDialect:         ^bb2:
! LLVMIRDialect:           oss.task firstprivate(%[[VAL_3]], %[[VAL_3]] : !llvm.ptr, !llvm.ptr) firstprivate_type(%[[VAL_4]], %[[VAL_4]] : i32, i32) {
! LLVMIRDialect:             %[[VAL_9:[-0-9A-Za-z._]+]] = llvm.mlir.constant(777 : i32) : i32
! LLVMIRDialect:             llvm.store %[[VAL_9]], %[[VAL_3]] : i32, !llvm.ptr
! LLVMIRDialect:             oss.terminator
! LLVMIRDialect:           }
! LLVMIRDialect:           llvm.return
! LLVMIRDialect:         }
! LLVMIRDialect:         llvm.func @_FortranAStopStatement(i32, i1 {llvm.zeroext}, i1 {llvm.zeroext}) -> !llvm.struct<()> attributes {fir.runtime, sym_visibility = "private"}

