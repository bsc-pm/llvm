! NOTE: Assertions have been autogenerated by /home/rpenacob/llvm-mono/mlir/utils/generate-test-checks.py
! Test test checks we do not emit duplicates data-sharings

! RUN: bbc -fompss-2 -emit-fir %s -o - | FileCheck %s --check-prefix=FIRDialect

program task
    INTEGER :: I, J, K, U

    !$OSS TASK DO DEFAULT(FIRSTPRIVATE) PRIVATE(J, J) FIRSTPRIVATE(U, K, K)
    DO I=1, 10
    U = 1
    END DO
    !$OSS END TASK DO

    !$OSS TASKLOOP DEFAULT(FIRSTPRIVATE) PRIVATE(J, J) FIRSTPRIVATE(U, K, K)
    DO I=1, 10
    U = 1
    END DO
    !$OSS END TASKLOOP

    !$OSS TASKLOOP DO DEFAULT(FIRSTPRIVATE) PRIVATE(J, J) FIRSTPRIVATE(U, K, K)
    DO I=1, 10
    U = 1
    END DO
    !$OSS END TASKLOOP DO

end program


! FIRDialect-LABEL:   func.func @_QQmain() attributes {fir.bindc_name = "task"} {
! FIRDialect:           %[[VAL_0:[-0-9A-Za-z._]+]] = fir.alloca i32 {bindc_name = "i", uniq_name = "_QFEi"}
! FIRDialect:           %[[VAL_1:[-0-9A-Za-z._]+]] = fir.alloca i32 {bindc_name = "j", uniq_name = "_QFEj"}
! FIRDialect:           %[[VAL_2:[-0-9A-Za-z._]+]] = fir.alloca i32 {bindc_name = "k", uniq_name = "_QFEk"}
! FIRDialect:           %[[VAL_3:[-0-9A-Za-z._]+]] = fir.alloca i32 {bindc_name = "u", uniq_name = "_QFEu"}
! FIRDialect:           %[[VAL_4:[-0-9A-Za-z._]+]] = fir.undefined !fir.oss<i32>
! FIRDialect:           %[[VAL_5:[-0-9A-Za-z._]+]] = fir.undefined !fir.oss<i32>
! FIRDialect:           %[[VAL_6:[-0-9A-Za-z._]+]] = fir.undefined !fir.oss<i32>
! FIRDialect:           %[[VAL_7:[-0-9A-Za-z._]+]] = fir.undefined !fir.oss<i32>
! FIRDialect:           %[[VAL_8:[-0-9A-Za-z._]+]] = arith.constant 1 : i32
! FIRDialect:           %[[VAL_9:[-0-9A-Za-z._]+]] = arith.constant 10 : i32
! FIRDialect:           %[[VAL_10:[-0-9A-Za-z._]+]] = arith.constant 1 : i32
! FIRDialect:           %[[VAL_11:[-0-9A-Za-z._]+]] = arith.constant 1 : i64
! FIRDialect:           oss.task_for lower_bound(%[[VAL_8]] : i32) upper_bound(%[[VAL_9]] : i32) step(%[[VAL_10]] : i32) loop_type(%[[VAL_11]] : i64) ind_var(%[[VAL_0]] : !fir.ref<i32>) private(%[[VAL_0]], %[[VAL_1]] : !fir.ref<i32>, !fir.ref<i32>) private_type(%[[VAL_4]], %[[VAL_5]] : !fir.oss<i32>, !fir.oss<i32>) firstprivate(%[[VAL_2]], %[[VAL_3]] : !fir.ref<i32>, !fir.ref<i32>) firstprivate_type(%[[VAL_6]], %[[VAL_7]] : !fir.oss<i32>, !fir.oss<i32>) default( deffirstprivate) {
! FIRDialect:             %[[VAL_12:[-0-9A-Za-z._]+]] = arith.constant 1 : i32
! FIRDialect:             fir.store %[[VAL_12]] to %[[VAL_3]] : !fir.ref<i32>
! FIRDialect:             oss.terminator
! FIRDialect:           }
! FIRDialect:           %[[VAL_13:[-0-9A-Za-z._]+]] = fir.undefined !fir.oss<i32>
! FIRDialect:           %[[VAL_14:[-0-9A-Za-z._]+]] = fir.undefined !fir.oss<i32>
! FIRDialect:           %[[VAL_15:[-0-9A-Za-z._]+]] = fir.undefined !fir.oss<i32>
! FIRDialect:           %[[VAL_16:[-0-9A-Za-z._]+]] = fir.undefined !fir.oss<i32>
! FIRDialect:           %[[VAL_17:[-0-9A-Za-z._]+]] = arith.constant 1 : i32
! FIRDialect:           %[[VAL_18:[-0-9A-Za-z._]+]] = arith.constant 10 : i32
! FIRDialect:           %[[VAL_19:[-0-9A-Za-z._]+]] = arith.constant 1 : i32
! FIRDialect:           %[[VAL_20:[-0-9A-Za-z._]+]] = arith.constant 1 : i64
! FIRDialect:           oss.taskloop lower_bound(%[[VAL_17]] : i32) upper_bound(%[[VAL_18]] : i32) step(%[[VAL_19]] : i32) loop_type(%[[VAL_20]] : i64) ind_var(%[[VAL_0]] : !fir.ref<i32>) private(%[[VAL_0]], %[[VAL_1]] : !fir.ref<i32>, !fir.ref<i32>) private_type(%[[VAL_13]], %[[VAL_14]] : !fir.oss<i32>, !fir.oss<i32>) firstprivate(%[[VAL_2]], %[[VAL_3]] : !fir.ref<i32>, !fir.ref<i32>) firstprivate_type(%[[VAL_15]], %[[VAL_16]] : !fir.oss<i32>, !fir.oss<i32>) default( deffirstprivate) {
! FIRDialect:             %[[VAL_21:[-0-9A-Za-z._]+]] = arith.constant 1 : i32
! FIRDialect:             fir.store %[[VAL_21]] to %[[VAL_3]] : !fir.ref<i32>
! FIRDialect:             oss.terminator
! FIRDialect:           }
! FIRDialect:           %[[VAL_22:[-0-9A-Za-z._]+]] = fir.undefined !fir.oss<i32>
! FIRDialect:           %[[VAL_23:[-0-9A-Za-z._]+]] = fir.undefined !fir.oss<i32>
! FIRDialect:           %[[VAL_24:[-0-9A-Za-z._]+]] = fir.undefined !fir.oss<i32>
! FIRDialect:           %[[VAL_25:[-0-9A-Za-z._]+]] = fir.undefined !fir.oss<i32>
! FIRDialect:           %[[VAL_26:[-0-9A-Za-z._]+]] = arith.constant 1 : i32
! FIRDialect:           %[[VAL_27:[-0-9A-Za-z._]+]] = arith.constant 10 : i32
! FIRDialect:           %[[VAL_28:[-0-9A-Za-z._]+]] = arith.constant 1 : i32
! FIRDialect:           %[[VAL_29:[-0-9A-Za-z._]+]] = arith.constant 1 : i64
! FIRDialect:           oss.taskloop_for lower_bound(%[[VAL_26]] : i32) upper_bound(%[[VAL_27]] : i32) step(%[[VAL_28]] : i32) loop_type(%[[VAL_29]] : i64) ind_var(%[[VAL_0]] : !fir.ref<i32>) private(%[[VAL_0]], %[[VAL_1]] : !fir.ref<i32>, !fir.ref<i32>) private_type(%[[VAL_22]], %[[VAL_23]] : !fir.oss<i32>, !fir.oss<i32>) firstprivate(%[[VAL_2]], %[[VAL_3]] : !fir.ref<i32>, !fir.ref<i32>) firstprivate_type(%[[VAL_24]], %[[VAL_25]] : !fir.oss<i32>, !fir.oss<i32>) default( deffirstprivate) {
! FIRDialect:             %[[VAL_30:[-0-9A-Za-z._]+]] = arith.constant 1 : i32
! FIRDialect:             fir.store %[[VAL_30]] to %[[VAL_3]] : !fir.ref<i32>
! FIRDialect:             oss.terminator
! FIRDialect:           }
! FIRDialect:           return
! FIRDialect:         }

! FIRDialect-LABEL:   fir.global @_QQEnvironmentDefaults constant : !fir.ref<tuple<i32, !fir.ref<!fir.array<0xtuple<!fir.ref<i8>, !fir.ref<i8>>>>>> {
! FIRDialect:           %[[VAL_0:[-0-9A-Za-z._]+]] = fir.zero_bits !fir.ref<tuple<i32, !fir.ref<!fir.array<0xtuple<!fir.ref<i8>, !fir.ref<i8>>>>>>
! FIRDialect:           fir.has_value %[[VAL_0]] : !fir.ref<tuple<i32, !fir.ref<!fir.array<0xtuple<!fir.ref<i8>, !fir.ref<i8>>>>>>
! FIRDialect:         }

