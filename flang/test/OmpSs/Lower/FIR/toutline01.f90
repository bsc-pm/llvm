! NOTE: Assertions have been autogenerated by /home/rpenacob/llvm-mono/mlir/utils/generate-test-checks.py
! RUN: bbc -emit-fir -fompss-2 %s -o - | FileCheck %s

! Based on Lower/array-constructor-2.f90

!  Dynamic array ctor with dynamic extent.
subroutine test3(a)
  real, allocatable :: b(:)
  interface
    !$OSS TASK
    subroutine test3b(x)
      real, allocatable :: x(:)
    end subroutine test3b
  end interface

  call test3b(b)
end subroutine test3

! CHECK-LABEL:   func.func @_QPtest3(
! CHECK-SAME:                        %[[VAL_0:[-0-9A-Za-z._]+]]: !fir.ref<f32> {fir.bindc_name = "a"}) {
! CHECK:           %[[VAL_1:[-0-9A-Za-z._]+]] = fir.alloca !fir.box<!fir.heap<!fir.array<?xf32>>> {bindc_name = "b", uniq_name = "_QFtest3Eb"}
! CHECK:           %[[VAL_2:[-0-9A-Za-z._]+]] = fir.zero_bits !fir.heap<!fir.array<?xf32>>
! CHECK:           %[[VAL_3:[-0-9A-Za-z._]+]] = arith.constant 0 : index
! CHECK:           %[[VAL_4:[-0-9A-Za-z._]+]] = fir.shape %[[VAL_3]] : (index) -> !fir.shape<1>
! CHECK:           %[[VAL_5:[-0-9A-Za-z._]+]] = fir.embox %[[VAL_2]](%[[VAL_4]]) : (!fir.heap<!fir.array<?xf32>>, !fir.shape<1>) -> !fir.box<!fir.heap<!fir.array<?xf32>>>
! CHECK:           fir.store %[[VAL_5]] to %[[VAL_1]] : !fir.ref<!fir.box<!fir.heap<!fir.array<?xf32>>>>
! CHECK:           oss.task shared(%[[VAL_1]] : !fir.ref<!fir.box<!fir.heap<!fir.array<?xf32>>>>) {
! CHECK:             fir.call @_QPtest3b(%[[VAL_1]]) fastmath<contract> : (!fir.ref<!fir.box<!fir.heap<!fir.array<?xf32>>>>) -> ()
! CHECK:             oss.terminator
! CHECK:           }
! CHECK:           return
! CHECK:         }
! CHECK:         func.func private @_QPtest3b(!fir.ref<!fir.box<!fir.heap<!fir.array<?xf32>>>>)

