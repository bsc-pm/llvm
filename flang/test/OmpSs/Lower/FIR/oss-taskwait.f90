! NOTE: Assertions have been autogenerated by /home/rpenacob/llvm-mono/mlir/utils/generate-test-checks.py
! This test checks lowering of OmpSs-2 taskwait Directive.

! RUN: bbc -hlfir=false -fompss-2 -emit-fir %s -o - | FileCheck %s --check-prefix=FIRDialect

program taskwait
    INTEGER :: I

    !$OSS TASKWAIT
    !$OSS TASKWAIT DEPEND(IN: I)
    !$OSS TASKWAIT IN(I)
    !$OSS TASKWAIT ON(I)

end program


! FIRDialect-LABEL:   func.func @_QQmain() attributes {fir.bindc_name = "taskwait"} {
! FIRDialect:           %[[VAL_0:[-0-9A-Za-z._]+]] = fir.alloca i32 {bindc_name = "i", uniq_name = "_QFEi"}
! FIRDialect:           oss.taskwait
! FIRDialect:           %[[VAL_1:[-0-9A-Za-z._]+]] = fir.undefined !fir.oss<i32>
! FIRDialect:           %[[VAL_2:[-0-9A-Za-z._]+]] = oss.dependency base(%[[VAL_0]] : !fir.ref<i32>) function(@compute.dep0) arguments(%[[VAL_0]] : !fir.ref<i32>) -> i32
! FIRDialect:           %[[VAL_3:[-0-9A-Za-z._]+]] = arith.constant false
! FIRDialect:           oss.task if(%[[VAL_3]] : i1) shared(%[[VAL_0]] : !fir.ref<i32>) shared_type(%[[VAL_1]] : !fir.oss<i32>) in(%[[VAL_2]] : i32) {
! FIRDialect:             oss.terminator
! FIRDialect:           }
! FIRDialect:           %[[VAL_4:[-0-9A-Za-z._]+]] = fir.undefined !fir.oss<i32>
! FIRDialect:           %[[VAL_5:[-0-9A-Za-z._]+]] = oss.dependency base(%[[VAL_0]] : !fir.ref<i32>) function(@compute.dep1) arguments(%[[VAL_0]] : !fir.ref<i32>) -> i32
! FIRDialect:           %[[VAL_6:[-0-9A-Za-z._]+]] = arith.constant false
! FIRDialect:           oss.task if(%[[VAL_6]] : i1) shared(%[[VAL_0]] : !fir.ref<i32>) shared_type(%[[VAL_4]] : !fir.oss<i32>) in(%[[VAL_5]] : i32) {
! FIRDialect:             oss.terminator
! FIRDialect:           }
! FIRDialect:           %[[VAL_7:[-0-9A-Za-z._]+]] = fir.undefined !fir.oss<i32>
! FIRDialect:           %[[VAL_8:[-0-9A-Za-z._]+]] = oss.dependency base(%[[VAL_0]] : !fir.ref<i32>) function(@compute.dep2) arguments(%[[VAL_0]] : !fir.ref<i32>) -> i32
! FIRDialect:           %[[VAL_9:[-0-9A-Za-z._]+]] = arith.constant false
! FIRDialect:           oss.task if(%[[VAL_9]] : i1) shared(%[[VAL_0]] : !fir.ref<i32>) shared_type(%[[VAL_7]] : !fir.oss<i32>) inout(%[[VAL_8]] : i32) {
! FIRDialect:             oss.terminator
! FIRDialect:           }
! FIRDialect:           return
! FIRDialect:         }

! FIRDialect-LABEL:   func.func @compute.dep0(
! FIRDialect-SAME:                            %[[VAL_0:[-0-9A-Za-z._]+]]: !fir.ref<i32>) -> (!fir.ref<i32>, i64, i64, i64) {
! FIRDialect:           %[[VAL_1:[-0-9A-Za-z._]+]] = arith.constant 1 : i64
! FIRDialect:           %[[VAL_2:[-0-9A-Za-z._]+]] = arith.constant 1 : i64
! FIRDialect:           %[[VAL_3:[-0-9A-Za-z._]+]] = arith.constant 4 : i64
! FIRDialect:           %[[VAL_4:[-0-9A-Za-z._]+]] = arith.subi %[[VAL_1]], %[[VAL_1]] : i64
! FIRDialect:           %[[VAL_5:[-0-9A-Za-z._]+]] = arith.subi %[[VAL_1]], %[[VAL_1]] : i64
! FIRDialect:           %[[VAL_6:[-0-9A-Za-z._]+]] = arith.addi %[[VAL_5]], %[[VAL_2]] : i64
! FIRDialect:           %[[VAL_7:[-0-9A-Za-z._]+]] = arith.muli %[[VAL_1]], %[[VAL_3]] : i64
! FIRDialect:           %[[VAL_8:[-0-9A-Za-z._]+]] = arith.muli %[[VAL_4]], %[[VAL_3]] : i64
! FIRDialect:           %[[VAL_9:[-0-9A-Za-z._]+]] = arith.muli %[[VAL_6]], %[[VAL_3]] : i64
! FIRDialect:           return %[[VAL_0]], %[[VAL_7]], %[[VAL_8]], %[[VAL_9]] : !fir.ref<i32>, i64, i64, i64
! FIRDialect:         }

! FIRDialect-LABEL:   func.func @compute.dep1(
! FIRDialect-SAME:                            %[[VAL_0:[-0-9A-Za-z._]+]]: !fir.ref<i32>) -> (!fir.ref<i32>, i64, i64, i64) {
! FIRDialect:           %[[VAL_1:[-0-9A-Za-z._]+]] = arith.constant 1 : i64
! FIRDialect:           %[[VAL_2:[-0-9A-Za-z._]+]] = arith.constant 1 : i64
! FIRDialect:           %[[VAL_3:[-0-9A-Za-z._]+]] = arith.constant 4 : i64
! FIRDialect:           %[[VAL_4:[-0-9A-Za-z._]+]] = arith.subi %[[VAL_1]], %[[VAL_1]] : i64
! FIRDialect:           %[[VAL_5:[-0-9A-Za-z._]+]] = arith.subi %[[VAL_1]], %[[VAL_1]] : i64
! FIRDialect:           %[[VAL_6:[-0-9A-Za-z._]+]] = arith.addi %[[VAL_5]], %[[VAL_2]] : i64
! FIRDialect:           %[[VAL_7:[-0-9A-Za-z._]+]] = arith.muli %[[VAL_1]], %[[VAL_3]] : i64
! FIRDialect:           %[[VAL_8:[-0-9A-Za-z._]+]] = arith.muli %[[VAL_4]], %[[VAL_3]] : i64
! FIRDialect:           %[[VAL_9:[-0-9A-Za-z._]+]] = arith.muli %[[VAL_6]], %[[VAL_3]] : i64
! FIRDialect:           return %[[VAL_0]], %[[VAL_7]], %[[VAL_8]], %[[VAL_9]] : !fir.ref<i32>, i64, i64, i64
! FIRDialect:         }

! FIRDialect-LABEL:   func.func @compute.dep2(
! FIRDialect-SAME:                            %[[VAL_0:[-0-9A-Za-z._]+]]: !fir.ref<i32>) -> (!fir.ref<i32>, i64, i64, i64) {
! FIRDialect:           %[[VAL_1:[-0-9A-Za-z._]+]] = arith.constant 1 : i64
! FIRDialect:           %[[VAL_2:[-0-9A-Za-z._]+]] = arith.constant 1 : i64
! FIRDialect:           %[[VAL_3:[-0-9A-Za-z._]+]] = arith.constant 4 : i64
! FIRDialect:           %[[VAL_4:[-0-9A-Za-z._]+]] = arith.subi %[[VAL_1]], %[[VAL_1]] : i64
! FIRDialect:           %[[VAL_5:[-0-9A-Za-z._]+]] = arith.subi %[[VAL_1]], %[[VAL_1]] : i64
! FIRDialect:           %[[VAL_6:[-0-9A-Za-z._]+]] = arith.addi %[[VAL_5]], %[[VAL_2]] : i64
! FIRDialect:           %[[VAL_7:[-0-9A-Za-z._]+]] = arith.muli %[[VAL_1]], %[[VAL_3]] : i64
! FIRDialect:           %[[VAL_8:[-0-9A-Za-z._]+]] = arith.muli %[[VAL_4]], %[[VAL_3]] : i64
! FIRDialect:           %[[VAL_9:[-0-9A-Za-z._]+]] = arith.muli %[[VAL_6]], %[[VAL_3]] : i64
! FIRDialect:           return %[[VAL_0]], %[[VAL_7]], %[[VAL_8]], %[[VAL_9]] : !fir.ref<i32>, i64, i64, i64
! FIRDialect:         }

! FIRDialect-LABEL:   fir.global @_QQEnvironmentDefaults constant : !fir.ref<tuple<i32, !fir.ref<!fir.array<0xtuple<!fir.ref<i8>, !fir.ref<i8>>>>>> {
! FIRDialect:           %[[VAL_0:[-0-9A-Za-z._]+]] = fir.zero_bits !fir.ref<tuple<i32, !fir.ref<!fir.array<0xtuple<!fir.ref<i8>, !fir.ref<i8>>>>>>
! FIRDialect:           fir.has_value %[[VAL_0]] : !fir.ref<tuple<i32, !fir.ref<!fir.array<0xtuple<!fir.ref<i8>, !fir.ref<i8>>>>>>
! FIRDialect:         }

