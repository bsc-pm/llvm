! NOTE: Assertions have been autogenerated by /home/rpenacob/llvm-mono/mlir/utils/generate-test-checks.py
! This test checks lowering of OmpSs-2 task Directive.

! RUN: flang-new -fc1 -emit-fir -fompss-2 -o - %s | FileCheck %s --check-prefix=FIRDialect

program task
    INTEGER :: I

    ! No clauses
    !$OSS TASK
    !$OSS END TASK

    ! if clause
    !$OSS TASK IF(I .EQ. 3)
    !$OSS END TASK

    ! final clause
    !$OSS TASK FINAL(I .EQ. 3)
    !$OSS END TASK

    ! cost clause
    !$OSS TASK COST(3)
    !$OSS END TASK

    ! priority clause
    !$OSS TASK PRIORITY(3)
    !$OSS END TASK

    ! default clause
    !$OSS TASK DEFAULT(SHARED)
    !$OSS END TASK

    ! private clause
    !$OSS TASK PRIVATE(I)
    !$OSS END TASK

    ! firstprivate clause
    !$OSS TASK FIRSTPRIVATE(I)
    !$OSS END TASK

    ! shared clause
    !$OSS TASK SHARED(I)
    !$OSS END TASK

end program


! FIRDialect-LABEL:   func.func @_QQmain() attributes {fir.bindc_name = "task"} {
! FIRDialect:           %[[VAL_0:[-0-9A-Za-z._]+]] = arith.constant 3 : i32
! FIRDialect:           %[[VAL_1:[-0-9A-Za-z._]+]] = fir.alloca i32 {bindc_name = "i", uniq_name = "_QFEi"}
! FIRDialect:           %[[VAL_2:[-0-9A-Za-z._]+]] = fir.declare %[[VAL_1]] {uniq_name = "_QFEi"} : (!fir.ref<i32>) -> !fir.ref<i32>
! FIRDialect:           oss.task {
! FIRDialect:             oss.terminator
! FIRDialect:           }
! FIRDialect:           %[[VAL_3:[-0-9A-Za-z._]+]] = fir.load %[[VAL_2]] : !fir.ref<i32>
! FIRDialect:           %[[VAL_4:[-0-9A-Za-z._]+]] = arith.cmpi eq, %[[VAL_3]], %[[VAL_0]] : i32
! FIRDialect:           oss.task if(%[[VAL_4]] : i1) {
! FIRDialect:             oss.terminator
! FIRDialect:           }
! FIRDialect:           %[[VAL_5:[-0-9A-Za-z._]+]] = fir.load %[[VAL_2]] : !fir.ref<i32>
! FIRDialect:           %[[VAL_6:[-0-9A-Za-z._]+]] = arith.cmpi eq, %[[VAL_5]], %[[VAL_0]] : i32
! FIRDialect:           oss.task final(%[[VAL_6]] : i1) {
! FIRDialect:             oss.terminator
! FIRDialect:           }
! FIRDialect:           oss.task cost(%[[VAL_0]] : i32) {
! FIRDialect:             oss.terminator
! FIRDialect:           }
! FIRDialect:           oss.task priority(%[[VAL_0]] : i32) {
! FIRDialect:             oss.terminator
! FIRDialect:           }
! FIRDialect:           oss.task default( defshared) {
! FIRDialect:             oss.terminator
! FIRDialect:           }
! FIRDialect:           %[[VAL_7:[-0-9A-Za-z._]+]] = fir.undefined !fir.oss<i32>
! FIRDialect:           %[[VAL_8:[-0-9A-Za-z._]+]] = fir.undefined !fir.oss<i32>
! FIRDialect:           oss.task private(%[[VAL_2]], %[[VAL_2]] : !fir.ref<i32>, !fir.ref<i32>) private_type(%[[VAL_7]], %[[VAL_8]] : !fir.oss<i32>, !fir.oss<i32>) {
! FIRDialect:             oss.terminator
! FIRDialect:           }
! FIRDialect:           %[[VAL_9:[-0-9A-Za-z._]+]] = fir.undefined !fir.oss<i32>
! FIRDialect:           %[[VAL_10:[-0-9A-Za-z._]+]] = fir.undefined !fir.oss<i32>
! FIRDialect:           oss.task firstprivate(%[[VAL_2]], %[[VAL_2]] : !fir.ref<i32>, !fir.ref<i32>) firstprivate_type(%[[VAL_9]], %[[VAL_10]] : !fir.oss<i32>, !fir.oss<i32>) {
! FIRDialect:             oss.terminator
! FIRDialect:           }
! FIRDialect:           %[[VAL_11:[-0-9A-Za-z._]+]] = fir.undefined !fir.oss<i32>
! FIRDialect:           %[[VAL_12:[-0-9A-Za-z._]+]] = fir.undefined !fir.oss<i32>
! FIRDialect:           oss.task shared(%[[VAL_2]], %[[VAL_2]] : !fir.ref<i32>, !fir.ref<i32>) shared_type(%[[VAL_11]], %[[VAL_12]] : !fir.oss<i32>, !fir.oss<i32>) {
! FIRDialect:             oss.terminator
! FIRDialect:           }
! FIRDialect:           return
! FIRDialect:         }

! FIRDialect-LABEL:   fir.global @_QQEnvironmentDefaults constant : !fir.ref<tuple<i32, !fir.ref<!fir.array<0xtuple<!fir.ref<i8>, !fir.ref<i8>>>>>> {
! FIRDialect:           %[[VAL_0:[-0-9A-Za-z._]+]] = fir.zero_bits !fir.ref<tuple<i32, !fir.ref<!fir.array<0xtuple<!fir.ref<i8>, !fir.ref<i8>>>>>>
! FIRDialect:           fir.has_value %[[VAL_0]] : !fir.ref<tuple<i32, !fir.ref<!fir.array<0xtuple<!fir.ref<i8>, !fir.ref<i8>>>>>>
! FIRDialect:         }

