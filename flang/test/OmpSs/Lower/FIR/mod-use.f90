! NOTE: Assertions have been autogenerated by /home/rpenacob/llvm-mono/mlir/utils/generate-test-checks.py
! RUN: bbc -fompss-2 -emit-fir %s -o - | FileCheck %s --check-prefix=FIRDialect

module mod
  implicit none
  integer :: x
end module mod

PROGRAM P
  use mod
  implicit none

  !$OSS TASK
  X = X + 1
  !$OSS END TASK
END

! FIRDialect-LABEL:   fir.global @_QMmodEx : i32 {
! FIRDialect:           %[[VAL_0:[-0-9A-Za-z._]+]] = fir.zero_bits i32
! FIRDialect:           fir.has_value %[[VAL_0]] : i32
! FIRDialect:         }

! FIRDialect-LABEL:   func.func @_QQmain() attributes {fir.bindc_name = "p"} {
! FIRDialect:           %[[VAL_0:[-0-9A-Za-z._]+]] = fir.address_of(@_QMmodEx) : !fir.ref<i32>
! FIRDialect:           %[[VAL_1:[-0-9A-Za-z._]+]] = fir.undefined !fir.oss<i32>
! FIRDialect:           oss.task firstprivate(%[[VAL_0]] : !fir.ref<i32>) firstprivate_type(%[[VAL_1]] : !fir.oss<i32>) {
! FIRDialect:             %[[VAL_2:[-0-9A-Za-z._]+]] = fir.load %[[VAL_0]] : !fir.ref<i32>
! FIRDialect:             %[[VAL_3:[-0-9A-Za-z._]+]] = arith.constant 1 : i32
! FIRDialect:             %[[VAL_4:[-0-9A-Za-z._]+]] = arith.addi %[[VAL_2]], %[[VAL_3]] : i32
! FIRDialect:             fir.store %[[VAL_4]] to %[[VAL_0]] : !fir.ref<i32>
! FIRDialect:             oss.terminator
! FIRDialect:           }
! FIRDialect:           return
! FIRDialect:         }

! FIRDialect-LABEL:   fir.global @_QQEnvironmentDefaults constant : !fir.ref<tuple<i32, !fir.ref<!fir.array<0xtuple<!fir.ref<i8>, !fir.ref<i8>>>>>> {
! FIRDialect:           %[[VAL_0:[-0-9A-Za-z._]+]] = fir.zero_bits !fir.ref<tuple<i32, !fir.ref<!fir.array<0xtuple<!fir.ref<i8>, !fir.ref<i8>>>>>>
! FIRDialect:           fir.has_value %[[VAL_0]] : !fir.ref<tuple<i32, !fir.ref<!fir.array<0xtuple<!fir.ref<i8>, !fir.ref<i8>>>>>>
! FIRDialect:         }

